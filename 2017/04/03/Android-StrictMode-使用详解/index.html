<!DOCTYPE html>
<html lang="zh">
    <head>
    <!-- 
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.0 -->

    <!-- Title -->
    
    <title>
        
            Android StrictMode 使用详解 | 
        
        一个老白 | 野厨
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Meta & Info -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Alex">
    <meta name="description" content="null">
    <meta name="keywords" content="null">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="一个老白 | 野厨">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://wanghaonanlpc.github.io">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Android StrictMode 使用详解 | 一个老白 | 野厨">
    <meta property="og:description" content="null">
    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }
</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>



    <script src="/js/jquery.min.js"></script>
    <script src="/js/queue.js"></script>

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    

    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#StrictMode具体能检测什么"><span class="post-toc-number">1.</span> <span class="post-toc-text">StrictMode具体能检测什么</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ThreadPolicy线程策略检测"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">ThreadPolicy线程策略检测</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#VmPolicy虚拟机策略检测"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">VmPolicy虚拟机策略检测</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#工作原理"><span class="post-toc-number">2.</span> <span class="post-toc-text">工作原理</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#常见用法"><span class="post-toc-number">3.</span> <span class="post-toc-text">常见用法</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#查看报告结果"><span class="post-toc-number">4.</span> <span class="post-toc-text">查看报告结果</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ThreadPolicy-详解"><span class="post-toc-number">5.</span> <span class="post-toc-text">ThreadPolicy 详解</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#detectNetwork-用于检查UI线程中是否有网络请求操作"><span class="post-toc-number">5.0.1.</span> <span class="post-toc-text">detectNetwork() 用于检查UI线程中是否有网络请求操作</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#detectDiskReads-和-detectDiskWrites-是磁盘读写检查"><span class="post-toc-number">5.0.2.</span> <span class="post-toc-text">detectDiskReads() 和 detectDiskWrites() 是磁盘读写检查</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#noteSlowCall针对执行比较耗时的检查"><span class="post-toc-number">5.0.3.</span> <span class="post-toc-text">noteSlowCall针对执行比较耗时的检查</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#penaltyDeath-，当触发违规条件时，直接Crash掉当前应用程序。"><span class="post-toc-number">5.0.4.</span> <span class="post-toc-text">penaltyDeath()，当触发违规条件时，直接Crash掉当前应用程序。</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#penaltyDeathOnNetwork-，当触发网络违规时，Crash掉当前应用程序。"><span class="post-toc-number">5.0.5.</span> <span class="post-toc-text">penaltyDeathOnNetwork()，当触发网络违规时，Crash掉当前应用程序。</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#penaltyDialog-，触发违规时，显示对违规信息对话框。"><span class="post-toc-number">5.0.6.</span> <span class="post-toc-text">penaltyDialog()，触发违规时，显示对违规信息对话框。</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#penaltyFlashScreen-，会造成屏幕闪烁，不过一般的设备可能没有这个功能。"><span class="post-toc-number">5.0.7.</span> <span class="post-toc-text">penaltyFlashScreen()，会造成屏幕闪烁，不过一般的设备可能没有这个功能。</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#penaltyDropBox-，将违规信息记录到-dropbox-系统日志目录中（-data-system-dropbox），你可以通过如下命令进行插件："><span class="post-toc-number">5.0.8.</span> <span class="post-toc-text">penaltyDropBox()，将违规信息记录到 dropbox 系统日志目录中（/data/system/dropbox），你可以通过如下命令进行插件：</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#permitCustomSlowCalls-、permitDiskReads-、permitDiskWrites-、permitNetwork：-如果你想关闭某一项检测，可以使用对应的permit-方法。"><span class="post-toc-number">5.0.9.</span> <span class="post-toc-text">permitCustomSlowCalls()、permitDiskReads ()、permitDiskWrites()、permitNetwork： 如果你想关闭某一项检测，可以使用对应的permit*方法。</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#VMPolicy-详解"><span class="post-toc-number">6.</span> <span class="post-toc-text">VMPolicy 详解</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#detectActivityLeaks-用户检查-Activity-的内存泄露情况"><span class="post-toc-number">6.0.1.</span> <span class="post-toc-text">detectActivityLeaks() 用户检查 Activity 的内存泄露情况</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#detectLeakedClosableObjects-用于资源没有正确关闭时提醒"><span class="post-toc-number">6.0.2.</span> <span class="post-toc-text">detectLeakedClosableObjects()用于资源没有正确关闭时提醒</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#detectLeakedSqlLiteObjects-和-detectLeakedClosableObjects-的用法类似，只不过是用来检查-SQLiteCursor-或者-其他-SQLite-对象是否被正确关闭"><span class="post-toc-number">6.0.3.</span> <span class="post-toc-text">detectLeakedSqlLiteObjects() 和 detectLeakedClosableObjects()的用法类似，只不过是用来检查 SQLiteCursor 或者 其他 SQLite 对象是否被正确关闭</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#detectLeakedRegistrationObjects-用来检查-BroadcastReceiver-或者-ServiceConnection-注册类对象是否被正确释放"><span class="post-toc-number">6.0.4.</span> <span class="post-toc-text">detectLeakedRegistrationObjects() 用来检查 BroadcastReceiver 或者 ServiceConnection 注册类对象是否被正确释放</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#setClassInstanceLimit-，设置某个类的同时处于内存中的实例上限，可以协助检查内存泄露"><span class="post-toc-number">6.0.5.</span> <span class="post-toc-text">setClassInstanceLimit()，设置某个类的同时处于内存中的实例上限，可以协助检查内存泄露</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#其他操作"><span class="post-toc-number">7.</span> <span class="post-toc-text">其他操作</span></a></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script>
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').css('background-image', 'url(' + '/img/random/material-' + randomNum + '.png' + ')');
</script>

        
    
            <p class="article-headline-p">
                Android StrictMode 使用详解
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Alex</strong>
        <span>4月 03, 2017</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
            <i class="material-icons" role="presentation">devices other</i>
            <span class="visuallyhidden">devices other</span>
        </button>
        <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
            <li class="mdl-menu__item">在其它设备中阅读本文章</li>
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAAC3ElEQVR42u3aUU7kMBAE0Ln/pdkDoISqdlgF++VrRELGz0i0utqfryOvDzY2NjY2NjY2NvYr2Z/4unzdxTNXP8mfv7o7WzM2Njb23uwf/vXHS7zfpvv33G/H9yfrNWNjY2MfwL4qAOvFY1bG8s/J1mBjY2Njtw1D0vAkW9m2JdjY2NjYeQHLG4M8bMpDJWxsbGzsWUAzi5NmcdVskICNjY19JjsPid7z+b/Ot7GxsbFfzG6vdolt4WnjquIN2NjY2Juyn4rpZxvRjoFn68TGxsbem30fDOWj1iRgase962vDxsbGPoHdHovJ7+ZbMwu2krvY2NjYJ7CTF62H9XnJnK2tHvRiY2Njb81uG4P8kE1xUHLUkNSDXmxsbOwt2HmDsdIG5HeLglSOfrGxsbF3ZedxUhs/rbQNs+CpDpWwsbGxN2LnTULeEsxKUf75gQKGjY2NvRE7/8p1QPvtyZ8nanWwsbGxt2a3wf1sTDtberK2aMuwsbGxD2C3ZakNgNq4v6UO59vY2NjYf5z9VDy0cnynDbBmY2NsbGzs09j5iLd9Zvb8rExiY2Njn8NOitlKQL8+yp01SNjY2NjnsNtDNrNh7WyQ3JbYYaiEjY2NvR17pQ1o46Qk7p9tCjY2NvYJ7FmxSUjtMZ18c2cHd7CxsbF3ZecD1xyZh1Z5w5Ovamkqgo2Njf1n2bNwP/+tWVF8dvCMjY2NfQK7DeuTxiAf37Ylqi142NjY2Oew2zFwGw+1G7pyYWNjY5/Abq9ZMJQf0Jl9YxKNYWNjY+/KHhaDhaOTswAraXjquo2NjY29EXu9wVg/UpkMIZLydvkkNjY29gHs9oBjvoi2FZkdx/yhacHGxsbGHg0AZkdzZj954KQSNjY29mHsPPppA/18s/JxAjY2NvYJ7CRUygH3I4HZUZ6VkTM2Njb23uw8pmlbkdmxm/bJX59vY2NjY7+Yfc6FjY2NjY2NjY2N/ZrrH+n6KlyozZBVAAAAAElFTkSuQmCC">
        </ul>
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    
    <!-- Leancloud Views -->
        <a class="post_share-link" href="#">
            <li class="mdl-menu__item">
                <span id="/2017/04/03/Android-StrictMode-使用详解/" class="leancloud-views_num" data-flag-title="Android StrictMode 使用详解">
     &nbsp;浏览量
</span>

            </li>
        </a>
    

    
        
            <!-- Busuanzi Views -->
            <a class="post_share-link" href="#">
                <li class="mdl-menu__item">
                    <span id="busuanzi_container_page_pv">
                        <span id="busuanzi_value_page_pv"></span>&nbsp;浏览量
                    </span>
                </li>
            </a>
        
    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Android StrictMode 使用详解&url=http://wanghaonanlpc.github.io//2017/04/03/Android-StrictMode-使用详解/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Android StrictMode 使用详解&url=http://wanghaonanlpc.github.io//2017/04/03/Android-StrictMode-使用详解/index.html&via=Alex" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://wanghaonanlpc.github.io//2017/04/03/Android-StrictMode-使用详解/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://wanghaonanlpc.github.io//2017/04/03/Android-StrictMode-使用详解/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=一个老白 | 野厨&title=Android StrictMode 使用详解&summary=null&pics=http://wanghaonanlpc.github.io/img/favicon.png&url=http://wanghaonanlpc.github.io/2017/04/03/Android-StrictMode-使用详解/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>   StrictMode类是Android 2.3 （API 9）引入的一个工具类，可以用来帮助开发者发现代码中的一些不规范的问题，以达到提升应用响应能力的目的。举个例子来说，如果开发者在UI线程中进行了网络操作或者文件系统的操作，而这些缓慢的操作会严重影响应用的响应能力，甚至出现ANR对话框。为了在开发中发现这些容易忽略的问题，我们使用StrictMode，系统检测出主线程违例的情况并做出相应的反应，最终帮助开发者优化和改善代码逻辑。</p>
<p>​       官网文档：<a href="https://link.juejin.im/?target=http%3A%2F%2Fdeveloper.android.com%2Freference%2Fandroid%2Fos%2FStrictMode.html" target="_blank" rel="external">http://developer.android.com/reference/android/os/StrictMode.html</a></p>
<h2 id="StrictMode具体能检测什么"><a href="#StrictMode具体能检测什么" class="headerlink" title="StrictMode具体能检测什么"></a>StrictMode具体能检测什么</h2><p>严苛模式主要检测两大问题，一个是线程策略，即TreadPolicy，另一个是VM策略，即VmPolicy。</p>
<h3 id="ThreadPolicy线程策略检测"><a href="#ThreadPolicy线程策略检测" class="headerlink" title="ThreadPolicy线程策略检测"></a>ThreadPolicy线程策略检测</h3><ul>
<li>线程策略检测的内容有</li>
<li>自定义的耗时调用 使用detectCustomSlowCalls()开启</li>
<li>磁盘读取操作 使用detectDiskReads()开启</li>
<li>磁盘写入操作 使用detectDiskWrites()开启</li>
<li>网络操作 使用detectNetwork()开启</li>
</ul>
<h3 id="VmPolicy虚拟机策略检测"><a href="#VmPolicy虚拟机策略检测" class="headerlink" title="VmPolicy虚拟机策略检测"></a>VmPolicy虚拟机策略检测</h3><ul>
<li>Activity泄露 使用detectActivityLeaks()开启</li>
<li>未关闭的Closable对象泄露 使用detectLeakedClosableObjects()开启</li>
<li>泄露的Sqlite对象 使用detectLeakedSqlLiteObjects()开启</li>
<li>检测实例数量 使用setClassInstanceLimit()开启</li>
</ul>
<h2 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h2><p>​       其实StrictMode实现原理也比较简单，以IO操作为例，主要是通过在open，read，write，close时进行监控。libcore.io.BlockGuardOs文件就是监控的地方。以open为例，如下进行监控。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public FileDescriptor open(String path, int flags, int mode) throws ErrnoException &#123;</div><div class="line">  BlockGuard.getThreadPolicy().onReadFromDisk();</div><div class="line">    if ((mode &amp; O_ACCMODE) != O_RDONLY) &#123;</div><div class="line">      BlockGuard.getThreadPolicy().onWriteToDisk();</div><div class="line">    &#125;</div><div class="line">    return os.open(path, flags, mode);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中onReadFromDisk()方法的实现，代码位于StrictMode.java中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public void onReadFromDisk() &#123;</div><div class="line">    if ((mPolicyMask &amp; DETECT_DISK_READ) == 0) &#123;</div><div class="line">      return;</div><div class="line">    &#125;</div><div class="line">    if (tooManyViolationsThisLoop()) &#123;</div><div class="line">      return;</div><div class="line">    &#125;</div><div class="line">    BlockGuard.BlockGuardPolicyException e = new StrictModeDiskReadViolation(mPolicyMask);</div><div class="line">    e.fillInStackTrace();</div><div class="line">    startHandlingViolationException(e);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="常见用法"><a href="#常见用法" class="headerlink" title="常见用法"></a>常见用法</h2><p>​       严格模式的开启可以放在Application或者Activity以及其他组件的onCreate方法。为了更好地分析应用中的问题，建议放在Application的onCreate方法中。<br>​       其中，我们只需要在app的开发版本下使用 StrictMode，线上版本避免使用 StrictMode，这里定义了一个布尔值变量DEV_MODE来进行控制。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">private boolean DEV_MODE = true</div><div class="line"> public void onCreate() &#123;</div><div class="line">     if (DEV_MODE) &#123;</div><div class="line">         StrictMode.setThreadPolicy(new StrictMode.ThreadPolicy.Builder()</div><div class="line">                 .detectCustomSlowCalls() //API等级11，使用StrictMode.noteSlowCode</div><div class="line">                 .detectDiskReads()</div><div class="line">                 .detectDiskWrites()</div><div class="line">                 .detectNetwork()   // or .detectAll() for all detectable problems</div><div class="line">                 .penaltyDialog() //弹出违规提示对话框</div><div class="line">                 .penaltyLog() //在Logcat 中打印违规异常信息</div><div class="line">                 .penaltyFlashScreen() //API等级11</div><div class="line">                 .build())</div><div class="line">         StrictMode.setVmPolicy(new StrictMode.VmPolicy.Builder()</div><div class="line">                 .detectLeakedSqlLiteObjects()</div><div class="line">                 .detectLeakedClosableObjects() //API等级11</div><div class="line">                 .penaltyLog()</div><div class="line">                 .penaltyDeath()</div><div class="line">                 .build())</div><div class="line">     &#125;</div><div class="line">     super.onCreate()</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>​       其中Android3.0引入的方法包括detectCustomSlowCalls()和noteSlowCode()，它们都是用来检测应用中执行缓慢代码的或者潜在的缓慢代码。</p>
<h2 id="查看报告结果"><a href="#查看报告结果" class="headerlink" title="查看报告结果"></a>查看报告结果</h2><p>​       严格模式有很多种报告违例的形式，但是想要分析具体违例情况，还是需要查看日志，终端下过滤StrictMode就能得到违例的具体stacktrace信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb logcat | grep StrictMode</div></pre></td></tr></table></figure>
<p><img src="https://user-gold-cdn.xitu.io/2016/11/29/0ea33120a6ffe723f35677b3ae654fe4" alt="这里写图片描述"></p>
<p>当然也可以选择弹窗形式来简明提醒开发者</p>
<p><img src="https://user-gold-cdn.xitu.io/2016/11/29/4f5db78b7fd3f070d2ffed2e87c6c91e" alt="弹窗警告"></p>
<h2 id="ThreadPolicy-详解"><a href="#ThreadPolicy-详解" class="headerlink" title="ThreadPolicy 详解"></a>ThreadPolicy 详解</h2><p>StrictMode.ThreadPolicy.Builder 主要方法如下</p>
<ul>
<li><h4 id="detectNetwork-用于检查UI线程中是否有网络请求操作"><a href="#detectNetwork-用于检查UI线程中是否有网络请求操作" class="headerlink" title="detectNetwork() 用于检查UI线程中是否有网络请求操作"></a>detectNetwork() 用于检查UI线程中是否有网络请求操作</h4></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">检测UI线程中网络请求案例：</div><div class="line"></div><div class="line">public class MainActivity extends AppCompatActivity implements View.OnClickListener &#123;</div><div class="line"></div><div class="line">    Button btnTest;</div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        StrictMode.setThreadPolicy(new StrictMode.ThreadPolicy.Builder()</div><div class="line">                .detectNetwork()</div><div class="line">                .penaltyLog()</div><div class="line">                .build());</div><div class="line">        btnTest = (Button) findViewById(R.id.btn_test);</div><div class="line">        btnTest.setOnClickListener(this);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onClick(View v) &#123;</div><div class="line">        int id = v.getId();</div><div class="line">        switch (id) &#123;</div><div class="line">            case R.id.btn_test:</div><div class="line">                postNetwork();</div><div class="line">            break;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 网络连接的操作</div><div class="line">     */</div><div class="line">    private void postNetwork() &#123;</div><div class="line">        try &#123;</div><div class="line">            URL url = new URL(&quot;http://www.wooyun.org&quot;);</div><div class="line">            HttpURLConnection conn = (HttpURLConnection) url.openConnection();</div><div class="line">            conn.connect();</div><div class="line">            BufferedReader reader = new BufferedReader(new InputStreamReader(</div><div class="line">                    conn.getInputStream()));</div><div class="line">            String lines = null;</div><div class="line">            StringBuffer sb = new StringBuffer();</div><div class="line">            while ((lines = reader.readLine()) != null) &#123;</div><div class="line">                sb.append(lines);</div><div class="line">            &#125;</div><div class="line">        &#125; catch (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行后，触发的警告如下</p>
<p><img src="https://user-gold-cdn.xitu.io/2016/11/29/0ea33120a6ffe723f35677b3ae654fe4" alt="这里写图片描述"></p>
<ul>
<li><h4 id="detectDiskReads-和-detectDiskWrites-是磁盘读写检查"><a href="#detectDiskReads-和-detectDiskWrites-是磁盘读写检查" class="headerlink" title="detectDiskReads() 和 detectDiskWrites() 是磁盘读写检查"></a>detectDiskReads() 和 detectDiskWrites() 是磁盘读写检查</h4></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">磁盘读写检查案例：</div><div class="line">public class MainActivity extends AppCompatActivity implements View.OnClickListener &#123;</div><div class="line"></div><div class="line">    Button btnTest;</div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        StrictMode.setThreadPolicy(new StrictMode.ThreadPolicy.Builder()</div><div class="line">                .detectDiskWrites()</div><div class="line">                .detectDiskReads()</div><div class="line">                .penaltyLog()</div><div class="line">                .build());</div><div class="line">        btnTest = (Button) findViewById(R.id.btn_test);</div><div class="line">        btnTest.setOnClickListener(this);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onClick(View v) &#123;</div><div class="line">        int id = v.getId();</div><div class="line">        switch (id) &#123;</div><div class="line">            case R.id.btn_test:</div><div class="line">                writeToExternalStorage();</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 文件系统的操作</div><div class="line">     */</div><div class="line">    public void writeToExternalStorage() &#123;</div><div class="line">        File externalStorage = Environment.getExternalStorageDirectory();</div><div class="line">        File mbFile = new File(externalStorage, &quot;castiel.txt&quot;);</div><div class="line">        try &#123;</div><div class="line">            OutputStream output = new FileOutputStream(mbFile, true);</div><div class="line">            output.write(&quot;www.wooyun.org&quot;.getBytes());</div><div class="line">            output.flush();</div><div class="line">            output.close();</div><div class="line">        &#125; catch (FileNotFoundException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; catch (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行后，触发的警告如下<br><img src="https://user-gold-cdn.xitu.io/2016/11/29/97ceb1872ac8c380f07db43e7914e0b9" alt="这里写图片描述"></p>
<ul>
<li><h4 id="noteSlowCall针对执行比较耗时的检查"><a href="#noteSlowCall针对执行比较耗时的检查" class="headerlink" title="noteSlowCall针对执行比较耗时的检查"></a>noteSlowCall针对执行比较耗时的检查</h4><p>​</p>
<p>​       StrictMode从 API 11开始允许开发者自定义一些耗时调用违例，这种自定义适用于自定义的任务执行类中，比如我们有一个进行任务处理的类，为TaskExecutor。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public class TaskExecutor &#123;</div><div class="line">    public void execute(Runnable task) &#123;</div><div class="line">        task.run();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​       先需要跟踪每个任务的耗时情况，如果大于500毫秒需要提示给开发者，noteSlowCall就可以实现这个功能，如下修改代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public class TaskExecutor &#123;</div><div class="line"></div><div class="line">    private static long SLOW_CALL_THRESHOLD = 500;</div><div class="line">    public void executeTask(Runnable task) &#123;</div><div class="line">        long startTime = SystemClock.uptimeMillis();</div><div class="line">        task.run();</div><div class="line">        long cost = SystemClock.uptimeMillis() - startTime;</div><div class="line">        if (cost &gt; SLOW_CALL_THRESHOLD) &#123;</div><div class="line">            StrictMode.noteSlowCall(&quot;slowCall cost=&quot; + cost);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>执行一个耗时2000毫秒的任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">TaskExecutor executor = new TaskExecutor();</div><div class="line">executor.executeTask(new Runnable() &#123;</div><div class="line">  @Override</div><div class="line">    public void run() &#123;</div><div class="line">        try &#123;</div><div class="line">          Thread.sleep(2000);</div><div class="line">        &#125; catch (InterruptedException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>​       得到的违例日志，注意其中~duration=20 ms并非耗时任务的执行时间，而我们的自定义信息msg=slowCall cost=2000才包含了真正的耗时。</p>
<ul>
<li><h4 id="penaltyDeath-，当触发违规条件时，直接Crash掉当前应用程序。"><a href="#penaltyDeath-，当触发违规条件时，直接Crash掉当前应用程序。" class="headerlink" title="penaltyDeath()，当触发违规条件时，直接Crash掉当前应用程序。"></a>penaltyDeath()，当触发违规条件时，直接Crash掉当前应用程序。</h4></li>
<li><h4 id="penaltyDeathOnNetwork-，当触发网络违规时，Crash掉当前应用程序。"><a href="#penaltyDeathOnNetwork-，当触发网络违规时，Crash掉当前应用程序。" class="headerlink" title="penaltyDeathOnNetwork()，当触发网络违规时，Crash掉当前应用程序。"></a>penaltyDeathOnNetwork()，当触发网络违规时，Crash掉当前应用程序。</h4></li>
<li><h4 id="penaltyDialog-，触发违规时，显示对违规信息对话框。"><a href="#penaltyDialog-，触发违规时，显示对违规信息对话框。" class="headerlink" title="penaltyDialog()，触发违规时，显示对违规信息对话框。"></a>penaltyDialog()，触发违规时，显示对违规信息对话框。</h4></li>
<li><h4 id="penaltyFlashScreen-，会造成屏幕闪烁，不过一般的设备可能没有这个功能。"><a href="#penaltyFlashScreen-，会造成屏幕闪烁，不过一般的设备可能没有这个功能。" class="headerlink" title="penaltyFlashScreen()，会造成屏幕闪烁，不过一般的设备可能没有这个功能。"></a>penaltyFlashScreen()，会造成屏幕闪烁，不过一般的设备可能没有这个功能。</h4></li>
<li><h4 id="penaltyDropBox-，将违规信息记录到-dropbox-系统日志目录中（-data-system-dropbox），你可以通过如下命令进行插件："><a href="#penaltyDropBox-，将违规信息记录到-dropbox-系统日志目录中（-data-system-dropbox），你可以通过如下命令进行插件：" class="headerlink" title="penaltyDropBox()，将违规信息记录到 dropbox 系统日志目录中（/data/system/dropbox），你可以通过如下命令进行插件："></a>penaltyDropBox()，将违规信息记录到 dropbox 系统日志目录中（/data/system/dropbox），你可以通过如下命令进行插件：</h4></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb shell dumpsys dropbox dataappstrictmode</div></pre></td></tr></table></figure>
<ul>
<li><h4 id="permitCustomSlowCalls-、permitDiskReads-、permitDiskWrites-、permitNetwork：-如果你想关闭某一项检测，可以使用对应的permit-方法。"><a href="#permitCustomSlowCalls-、permitDiskReads-、permitDiskWrites-、permitNetwork：-如果你想关闭某一项检测，可以使用对应的permit-方法。" class="headerlink" title="permitCustomSlowCalls()、permitDiskReads ()、permitDiskWrites()、permitNetwork： 如果你想关闭某一项检测，可以使用对应的permit*方法。"></a>permitCustomSlowCalls()、permitDiskReads ()、permitDiskWrites()、permitNetwork： 如果你想关闭某一项检测，可以使用对应的permit*方法。</h4></li>
</ul>
<h2 id="VMPolicy-详解"><a href="#VMPolicy-详解" class="headerlink" title="VMPolicy 详解"></a>VMPolicy 详解</h2><p>StrictMode.VmPolicy.Builder 主要方法如下</p>
<ul>
<li><h4 id="detectActivityLeaks-用户检查-Activity-的内存泄露情况"><a href="#detectActivityLeaks-用户检查-Activity-的内存泄露情况" class="headerlink" title="detectActivityLeaks() 用户检查 Activity 的内存泄露情况"></a>detectActivityLeaks() 用户检查 Activity 的内存泄露情况</h4></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">内存泄露检查案例：</div><div class="line">public class MainActivity extends AppCompatActivity implements View.OnClickListener &#123;</div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        StrictMode.setVmPolicy(new StrictMode.VmPolicy.Builder()</div><div class="line">                .detectActivityLeaks()</div><div class="line">                .penaltyLog()</div><div class="line">                .build()</div><div class="line">        );</div><div class="line"></div><div class="line">        new Thread() &#123;</div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line">                while (true) &#123;</div><div class="line"></div><div class="line">                    SystemClock.sleep(1000);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;.start();</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们反复旋转屏幕就会输出提示信息（重点在 instances=2; limit=1 这一行）<br><img src="https://user-gold-cdn.xitu.io/2016/11/29/e3c9e921a730c5e7a8bd546a405ee0cb" alt="这里写图片描述"><br>​       这时因为，我们在Activity中创建了一个Thread匿名内部类，而匿名内部类隐式持有外部类的引用。而每次旋转屏幕是，Android会新创建一个Activity，而原来的Activity实例又被我们启动的匿名内部类线程持有，所以不会释放，从日志上看，当先系统中该Activty有4个实例，而限制是只能创建1各实例。我们不断翻转屏幕，instances 的个数还会持续增加。</p>
<ul>
<li><h4 id="detectLeakedClosableObjects-用于资源没有正确关闭时提醒"><a href="#detectLeakedClosableObjects-用于资源没有正确关闭时提醒" class="headerlink" title="detectLeakedClosableObjects()用于资源没有正确关闭时提醒"></a>detectLeakedClosableObjects()用于资源没有正确关闭时提醒</h4></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity implements View.OnClickListener &#123;</div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        StrictMode.setVmPolicy(new StrictMode.VmPolicy.Builder()</div><div class="line">                .detectLeakedClosableObjects()</div><div class="line">                .penaltyLog()</div><div class="line">                .build()</div><div class="line">        );</div><div class="line"></div><div class="line">        File newxmlfile = new File(Environment.getExternalStorageDirectory(), &quot;castiel.txt&quot;);</div><div class="line">        try &#123;</div><div class="line">            newxmlfile.createNewFile();</div><div class="line">            FileWriter fw = new FileWriter(newxmlfile);</div><div class="line">            fw.write(&quot;猴子搬来的救兵WooYun&quot;);</div><div class="line">            </div><div class="line">        &#125; catch (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行后触发警告如下<br><img src="https://user-gold-cdn.xitu.io/2016/11/29/c65025d4aed04406cc2fb57458ee9d7f" alt="这里写图片描述"></p>
<ul>
<li><h4 id="detectLeakedSqlLiteObjects-和-detectLeakedClosableObjects-的用法类似，只不过是用来检查-SQLiteCursor-或者-其他-SQLite-对象是否被正确关闭"><a href="#detectLeakedSqlLiteObjects-和-detectLeakedClosableObjects-的用法类似，只不过是用来检查-SQLiteCursor-或者-其他-SQLite-对象是否被正确关闭" class="headerlink" title="detectLeakedSqlLiteObjects() 和 detectLeakedClosableObjects()的用法类似，只不过是用来检查 SQLiteCursor 或者 其他 SQLite 对象是否被正确关闭"></a>detectLeakedSqlLiteObjects() 和 detectLeakedClosableObjects()的用法类似，只不过是用来检查 SQLiteCursor 或者 其他 SQLite 对象是否被正确关闭</h4></li>
<li><h4 id="detectLeakedRegistrationObjects-用来检查-BroadcastReceiver-或者-ServiceConnection-注册类对象是否被正确释放"><a href="#detectLeakedRegistrationObjects-用来检查-BroadcastReceiver-或者-ServiceConnection-注册类对象是否被正确释放" class="headerlink" title="detectLeakedRegistrationObjects() 用来检查 BroadcastReceiver 或者 ServiceConnection 注册类对象是否被正确释放"></a>detectLeakedRegistrationObjects() 用来检查 BroadcastReceiver 或者 ServiceConnection 注册类对象是否被正确释放</h4></li>
<li><h4 id="setClassInstanceLimit-，设置某个类的同时处于内存中的实例上限，可以协助检查内存泄露"><a href="#setClassInstanceLimit-，设置某个类的同时处于内存中的实例上限，可以协助检查内存泄露" class="headerlink" title="setClassInstanceLimit()，设置某个类的同时处于内存中的实例上限，可以协助检查内存泄露"></a>setClassInstanceLimit()，设置某个类的同时处于内存中的实例上限，可以协助检查内存泄露</h4></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">检测内存泄露案例</div><div class="line">public class MainActivity extends AppCompatActivity implements View.OnClickListener &#123;</div><div class="line"></div><div class="line">    private static class CastielClass&#123;&#125;</div><div class="line">    private static List classList;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        classList = new ArrayList();</div><div class="line"></div><div class="line">        StrictMode.setVmPolicy(new StrictMode.VmPolicy.Builder()</div><div class="line">                .setClassInstanceLimit(CastielClass.class, 2)</div><div class="line">                .penaltyLog()</div><div class="line">                .build());</div><div class="line"></div><div class="line">        classList.add(new CastielClass());</div><div class="line">        classList.add(new CastielClass());</div><div class="line">        classList.add(new CastielClass());</div><div class="line">        classList.add(new CastielClass());</div><div class="line">        classList.add(new CastielClass());</div><div class="line">        classList.add(new CastielClass());</div><div class="line">        classList.add(new CastielClass());</div><div class="line">        classList.add(new CastielClass());</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行后触发警告如下</p>
<p><img src="https://user-gold-cdn.xitu.io/2016/11/29/145a4310ac2183dcfbaba3ce4307cfa2" alt="这里写图片描述"></p>
<h2 id="其他操作"><a href="#其他操作" class="headerlink" title="其他操作"></a>其他操作</h2><p>​       除了通过日志查看之外，我们也可以在开发者选项中开启严格模式，开启之后，如果主线程中有执行时间长的操作，屏幕则会闪烁，这是一个更加直接的方法。<br><img src="https://user-gold-cdn.xitu.io/2016/11/29/f2adecc3e7f0e358b2fcad32eb405b6b" alt="这里写图片描述"></p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    




    <!-- 使用 DISQUS_CLICK -->
    <div id="disqus-comment">	
        <div id="disqus_thread"></div>
<!-- include js -->
<script src="/js/ripple.js"></script>

<!-- add animation -->
<style>
        .ripple-container {
        }
        .ripple-container .ripple{
            background-color: rgba(255,255,255,0.4);
            animation: ripple 2s forwards cubic-bezier(0, 0, 0.2, 1);
        }
        @keyframes ripple {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            80% {
                transform: scale(1);
            }
            100% {
                opacity: 0;
            }
        }
		.disqus_click_btn {
            background-color: dodgerblue;
            color: white;
            padding: 10px 20px;
            border:0;
            font-size: 14px;
            cursor: pointer
        }
</style>
	
<!-- add data-ripple attribute -->
<div class="btn_click_load"> 
    <button class="disqus_click_btn" data-ripple>阅读评论 「请确保 disq.us &amp; disquscdn.com &amp; disqus.com 可以正常加载」</button>
</div>
	
<script>
    // add effect to elements
    Array.prototype.forEach.call(document.querySelectorAll('[data-ripple]'), function(element){
        // find all elements and attach effect
        new RippleEffect(element); // element is instance of javascript element node
    });
</script>

<script>
    $('.btn_click_load').click(function() {  //click to load comments
        var disqus_config = function () {
            this.page.url = 'http://wanghaonanlpc.github.io/2017/04/03/Android-StrictMode-使用详解/index.html';  // Replace PAGE_URL with your page's canonical URL variable
            this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        };
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document;
            var s = d.createElement('script');
            s.src = '//wanghaonanlpc.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
        })();
        $('.btn_click_load').css('display','none');
    });
</script>
  	

    </div>
    <style>
        #disqus-comment{
            background-color: #eee;
            padding: 2pc;
        }
    </style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/03/24/Mac-os-10-8-一键安装PHP、Mysql、Nginx/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="Alex's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        15208292733@163.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">19</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">16</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">十二月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">五月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">三月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/02/">二月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/01/">一月 2014<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/android/">android<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/hexo/">hexo<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/node-js/">node.js<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/nodejs/">nodejs<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/npdp/">npdp<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/写作/">写作<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/前端/">前端<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/前端/javascript/">javascript<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/安卓/">安卓<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/categories/移动端/">移动端<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/英语/">英语<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/about" title="About">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                About
            </a>
        </li>
        
    
        <li>
            <a href="/links" title="Links">
                
                    <i class="material-icons sidebar-material-icons">link</i>
                
                Links
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">42</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

    <a href="mailto:hiviosey@gmail.com" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
        sidebar.help
        <span class="mdl-button__ripple-container">
          <span class="mdl-ripple"></span>
        </span>
      </div>
    </a>

-->

<!-- Feedback -->
<!--

    <a href="https://github.com/viosey/hexo-theme-material/issues" target="_blank" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
        sidebar.feedback
        <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
    </a>

-->

<!-- About Theme -->
<!--

    <a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
             sidebar.about_theme
            <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
    </a>

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/_wanghaonanlpc" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.png);">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/profile.php?id=100011481588031" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-facebook.png);">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://plus.google.com/u/0/104162583407619782102" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-gplus.png);">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    
        <a href="http://weibo.com/2123136342/profile?topnav=1&amp;wvr=6" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-weibo.png);">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    
        <a href="https://www.instagram.com/wanghaonanlpc/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-instagram.png);">
                <span class="visuallyhidden">Instagram</span>
            </button><!--
     --></a>
    

    <!-- Tumblr -->
    
        <a href="https://www.tumblr.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-tumblr.png);">
                <span class="visuallyhidden">Tumblr</span>
            </button><!--
     --></a>
    

    <!-- Github -->
    
        <a href="https://github.com/wanghaonanlpc" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.png);">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    
        <a href="https://www.zhihu.com/people/wanghaonanlpc" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-zhihu.png);">
                <span class="visuallyhidden">Zhihu</span>
            </button><!--
     --></a>
    

    <!-- Bilibili -->
    
        <a href="http://www.bilibili.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-bilibili.png);">
                <span class="visuallyhidden">Bilibili</span>
            </button><!--
     --></a>
    

    <!-- Telegram -->
    
        <a href="https://telegram.org/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-telegram.png);">
                <span class="visuallyhidden">Telegram</span>
            </button><!--
     --></a>
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;一个老白 | 野厨
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->
<script src="/js/lazyload.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>



    <script src="/js/smoothscroll.js"></script>



    <!-- Leancloud -->
    <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
    <script>
        AV.initialize('VadYH9itW5BSteJpvBD6W2p1-gzGzoHsz', 'w8vi528umHoqY2e41U6MAW0c');
    </script>
    <script>
    function showTime(Counter) {
        var query = new AV.Query(Counter);
        $('.leancloud-views_num').each(function() {
            var url = $(this).attr('id').trim();
            query.equalTo('url', url);
            query.find({
                success: function(results) {
                    if (results.length === 0) {
                        var content = '0 ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                        return;
                    }
                    for (var i = 0; i < results.length; i++) {
                        var object = results[i];
                        var content = object.get('time') + ' ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                    }
                },
                error: function(object, error) {
                    console.log('Error: ' + error.code + ' ' + error.message);
                }
            });
        });
    }

    function addCount(Counter) {
      var Counter = AV.Object.extend('Counter');
      url = $('.leancloud-views_num').attr('id').trim();
      title = $('.leancloud-views_num').attr('data-flag-title').trim();
      var query = new AV.Query(Counter);
      query.equalTo('url', url);
      query.find({
          success: function(results) {
            if (results.length > 0) {
                var counter = results[0];
                counter.fetchWhenSave(true);
                counter.increment('time');
                counter.save(null, {
                    success: function(counter) {
                        var content =  counter.get('time') + ' ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                    },
                    error: function(counter, error) {
                        console.log('Failed to save Visitor num, with error message: ' + error.message);
                    }
                });
            } else {
              var newcounter = new Counter();
              newcounter.set('title', title);
              newcounter.set('url', url);
              newcounter.set('time', 1);
              newcounter.save(null, {
                  success: function(newcounter) {
                      console.log('newcounter.get(\'time\')='+newcounter.get('time'));
                      var content = newcounter.get('time') + ' ' + $(document.getElementById(url)).text();
                      $(document.getElementById(url)).text(content);
                  },
                  error: function(newcounter, error) {
                      console.log('Failed to create');
                  }
              });
            }
        },
        error: function(error) {
            console.log('Error:' + error.code + ' ' + error.message);
        }
      });
    }
    $(function() {
        var Counter = AV.Object.extend('Counter');
        if ($('.leancloud-views_num').length === 1) {
            addCount(Counter);
        } else if ($('.post-title-link').length > 1) {
            showTime(Counter);
        }
    });
</script>




    <!-- Busuanzi -->
    <script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>







<!-- Swiftye -->


<!-- Local Search-->

    <script>
    var searchFunc = function(path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: 'xml',
            success: function( xmlResponse ) {
                // get the contents from search data
                var datas = $( 'entry', xmlResponse ).map(function() {
                    return {
                        title: $( 'title', this ).text(),
                        content: $('content',this).text(),
                        url: $( 'url' , this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function() {
                    var str='<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = '';
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function(data) {
                        var isMatch = true;
                        var content_index = [];
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g,'').toLowerCase();
                        var data_url = data.url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if(data_title !== '' && data_content !== '') {
                            keywords.forEach(function(keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if( index_title < 0 && index_content < 0 ) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += '<li><a href="'+ data_url +'" class="search-result-title" target="_blank">'+ data_title;
                            var content = data.content.trim().replace(/<[^>]+>/g, '');
                            if (first_occur >= 0) {
                                // cut out characters
                                var start = first_occur - 6;
                                var end = first_occur + 6;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 10;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, 'gi');
                                    match_content = match_content.replace(regS, '<em class="search-keyword">'+keyword+'</em>');
                                })
                                str += '<p class="search-result">' + match_content + '...</p>' +'</a>';
                            }
                        }
                    });
                    $resultContent.innerHTML = str;
                });
            }
        });
    }
</script>


    <script>
        var inputArea = document.querySelector('#search');
        var getSearchFile = function() {
            var path = 'search.xml';
            searchFunc(path, 'search', 'local-search-result');
        }

        if(inputArea) {
            inputArea.onfocus = function() {
                getSearchFile();
            }
        }
    </script>


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->


                </main>
            </div>
        </body>
    
</html>
